<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Image Filters - WebAssembly Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        canvas {
            border: 2px solid #ccc;
            display: block;
            margin: 20px auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            padding: 40px;
            margin: 20px 0;
            text-align: center;
            background: white;
            border-radius: 8px;
        }
        
        .filter-buttons {
            margin: 20px 0;
        }
        
        button {
            background: #007cba;
            border: none;
            color: white;
            padding: 12px 24px;
            margin: 5px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
        }
        
        button:hover {
            background: #005a87;
        }
        
        .performance {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .upload-input {
            margin: 10px 0;
        }

        .info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Real-Time Image Filters with WebAssembly</h1>
        <p>Upload an image and apply various filters in real-time using WebAssembly for maximum performance!</p>
        
        <div class="upload-area">
            <h3>Upload an Image</h3>
            <input type="file" id="image-upload" class="upload-input" accept="image/*">
            <p>Choose any image file (.jpg, .png, .gif, etc.)</p>
        </div>
        
        <canvas id="image-canvas"></canvas>
        
        <div class="controls">
            <div class="filter-buttons">
                <button id="original-btn">Original</button>
                <button id="blur-btn">Blur</button>
                <button id="sharpen-btn">Sharpen</button>
                <button id="brighten-btn">Brighten</button>
                <button id="grayscale-btn">Grayscale</button>
            </div>
        </div>
        
        <div class="performance">
            <h3>Performance:</h3>
            <p>WebAssembly Processing Time: <span id="wasm-time">-</span></p>
            <p><em>This shows how fast WebAssembly can process your image compared to regular JavaScript!</em></p>
        </div>
        
        <div class="info">
            <h3>Instructions:</h3>
            <ul>
                <li>Click "Upload an Image" and select any image file from your computer</li>
                <li>Try different filters to see how they change your image</li>
                <li>Watch the performance timer to see how fast WebAssembly processes your image!</li>
                <li>Click "Original" to see your unmodified image again</li>
            </ul>
        </div>
    </div>

    <script src="image_filter.js"></script>
    <script src="image_filter_app.js"></script>
    <script>
        let app;
        
        function initApp() {
            console.log('WebAssembly module loaded and ready!');
            console.log('Module:', Module);
            console.log('HEAPU8 available:', !!Module.HEAPU8);
            
            app = new ImageFilterDemo();
            app.module = Module;
        }
        
        if (typeof Module !== 'undefined' && Module.calledRun) {
            initApp();
        } else if (typeof Module !== 'undefined') {
            Module.onRuntimeInitialized = initApp;
        } else {
            let checkCount = 0;
            const checkModule = setInterval(() => {
                checkCount++;
                if (typeof Module !== 'undefined') {
                    clearInterval(checkModule);
                    if (Module.calledRun) {
                        initApp();
                    } else {
                        Module.onRuntimeInitialized = initApp;
                    }
                } else if (checkCount > 50) {
                    clearInterval(checkModule);
                    console.error('Module failed to load after 5 seconds');
                }
            }, 100);
        }
    </script>
</body>
</html>
